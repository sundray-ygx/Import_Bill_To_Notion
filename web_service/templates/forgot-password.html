<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿˜è®°å¯†ç  - Notionè´¦å•å¯¼å…¥æœåŠ¡</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/auth.css">
    <link rel="stylesheet" href="/static/css/variables.css">
</head>
<body class="auth-page">
    <div class="auth-container">
        <!-- å·¦ä¾§ï¼šå“ç‰Œä¿¡æ¯ -->
        <div class="auth-brand">
            <div class="brand-logo">ğŸ”‘</div>
            <h1 class="brand-title">å¿˜è®°å¯†ç ï¼Ÿ</h1>
            <p class="brand-subtitle">ä¸ç”¨æ‹…å¿ƒï¼Œæˆ‘ä»¬ä¼šå¸®æ‚¨æ‰¾å›è´¦æˆ·</p>

            <div class="brand-features">
                <div class="feature-item">
                    <i>âœ“</i>
                    <span>å¿«é€Ÿå®‰å…¨çš„å¯†ç é‡ç½®æµç¨‹</span>
                </div>
                <div class="feature-item">
                    <i>âœ“</i>
                    <span>å‡ åˆ†é’Ÿå†…å³å¯æ¢å¤è®¿é—®</span>
                </div>
                <div class="feature-item">
                    <i>âœ“</i>
                    <span>è”ç³»ç®¡ç†å‘˜è·å–å¸®åŠ©</span>
                </div>
            </div>
        </div>

        <!-- å³ä¾§ï¼šé‡ç½®å¯†ç è¡¨å• -->
        <div class="auth-form-wrapper">
            <form class="auth-form" id="forgot-password-form">
                <div class="form-header">
                    <h2>é‡ç½®å¯†ç </h2>
                    <p>è¯·è¾“å…¥æ‚¨çš„æ³¨å†Œé‚®ç®±ï¼Œæˆ‘ä»¬ä¼šå‘é€é‡ç½®é“¾æ¥</p>
                </div>

                <!-- æ¶ˆæ¯æç¤º -->
                <div id="alert-container"></div>

                <div class="form-group">
                    <label for="email">ç”µå­é‚®ç®±</label>
                    <input
                        type="email"
                        id="email"
                        name="email"
                        class="form-input"
                        placeholder="è¯·è¾“å…¥æ³¨å†Œæ—¶ä½¿ç”¨çš„é‚®ç®±"
                        required
                    >
                </div>

                <button type="submit" class="btn btn-primary btn-block btn-large" id="submit-btn">
                    <span class="btn-text">å‘é€é‡ç½®é“¾æ¥</span>
                    <span class="btn-loading" style="display: none;">
                        <span class="icon-spinner">â³</span> å‘é€ä¸­...
                    </span>
                </button>

                <div class="form-footer">
                    <p>è®°èµ·å¯†ç äº†ï¼Ÿ<a href="/login" class="link">è¿”å›ç™»å½•</a></p>
                </div>
            </form>

            <!-- ç®¡ç†å‘˜è”ç³»ä¿¡æ¯ -->
            <div class="admin-contact" id="admin-contact" style="display: none;">
                <div class="form-header">
                    <h2>è”ç³»ç®¡ç†å‘˜</h2>
                    <p>è¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ç®¡ç†å‘˜é‡ç½®å¯†ç </p>
                </div>

                <div class="contact-info">
                    <div class="contact-item">
                        <span class="contact-icon">ğŸ“§</span>
                        <div>
                            <div class="contact-label">é‚®ç®±</div>
                            <div class="contact-value">admin@example.com</div>
                        </div>
                    </div>
                </div>

                <div class="form-footer">
                    <p><a href="/login" class="link">è¿”å›ç™»å½•</a></p>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/auth.js"></script>
    <script>
    (function() {
        'use strict';

        const form = document.getElementById('forgot-password-form');
        const emailInput = document.getElementById('email');
        const submitBtn = document.getElementById('submit-btn');
        const alertContainer = document.getElementById('alert-container');

        // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
        function showAlert(message, type = 'error') {
            alertContainer.innerHTML = `
                <div class="alert alert-${type}" style="padding: 12px 16px; border-radius: 8px; margin-bottom: 16px; ${type === 'error' ? 'background: #fef2f2; color: #dc2626; border: 1px solid #fecaca;' : 'background: #f0fdf4; color: #16a34a; border: 1px solid #bbf7d0;'}">
                    ${message}
                </div>
            `;
        }

        // è¡¨å•æäº¤
        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            const email = emailInput.value.trim();

            if (!email) {
                showAlert('è¯·è¾“å…¥é‚®ç®±åœ°å€');
                return;
            }

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            submitBtn.disabled = true;
            submitBtn.querySelector('.btn-text').style.display = 'none';
            submitBtn.querySelector('.btn-loading').style.display = 'inline';

            try {
                // æ£€æŸ¥æ˜¯å¦å­˜åœ¨å¤šç§Ÿæˆ·æ•°æ®åº“
                const checkResponse = await fetch('/api/auth/setup/check');
                const checkData = await checkResponse.json();

                if (checkData.needs_setup || checkData.user_count === 0) {
                    // å•ç”¨æˆ·æ¨¡å¼ - æ˜¾ç¤ºè”ç³»ä¿¡æ¯
                    showAlert('å½“å‰ä¸ºå•ç”¨æˆ·æ¨¡å¼ï¼Œè¯·è”ç³»ç®¡ç†å‘˜é‡ç½®å¯†ç ', 'info');
                    form.style.display = 'none';
                    document.getElementById('admin-contact').style.display = 'block';
                } else {
                    // å¤šç”¨æˆ·æ¨¡å¼ - è¯´æ˜éœ€è¦è”ç³»ç®¡ç†å‘˜
                    showAlert('å¯†ç é‡ç½®åŠŸèƒ½éœ€è¦è”ç³»ç®¡ç†å‘˜ã€‚è¯·å‘é€é‚®ä»¶è‡³ admin@example.com ç”³è¯·é‡ç½®å¯†ç ã€‚', 'info');
                    form.style.display = 'none';
                    document.getElementById('admin-contact').style.display = 'block';
                }
            } catch (error) {
                console.error('Password reset error:', error);
                showAlert('ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥è¿æ¥æˆ–ç¨åé‡è¯•', 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.querySelector('.btn-text').style.display = 'inline';
                submitBtn.querySelector('.btn-loading').style.display = 'none';
            }
        });
    })();
    </script>

    <style>
    .admin-contact {
        text-align: center;
    }

    .contact-info {
        margin: 24px 0;
    }

    .contact-item {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 16px;
        padding: 16px;
        background: #f9fafb;
        border-radius: 12px;
        margin-bottom: 12px;
    }

    .contact-icon {
        font-size: 1.5rem;
    }

    .contact-label {
        font-size: 0.85rem;
        color: #6b7280;
        margin-bottom: 4px;
    }

    .contact-value {
        font-weight: 600;
        color: #1a1a2e;
    }
    </style>
</body>
</html>
