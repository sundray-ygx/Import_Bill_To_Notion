<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è´¦æˆ·è®¾ç½® - Notionè´¦å•å¯¼å…¥æœåŠ¡</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/settings.css">
    <!-- æ€§èƒ½ä¼˜åŒ–ï¼šCSSå˜é‡ç³»ç»Ÿ -->
    <link rel="stylesheet" href="/static/css/variables.css">
    <!-- èµ„æºé¢„åŠ è½½ -->
    <link rel="preload" href="/static/js/perf-utils.js" as="script">
</head>
<body>
    <!-- å¯¼èˆªæ ç»„ä»¶ -->
    {% include "components/navbar.html" %}

    <main class="settings-main">
        <div class="settings-container">
            <!-- ä¾§è¾¹æ å¯¼èˆª -->
            <aside class="settings-sidebar">
                <div class="sidebar-section">
                    <h3>è´¦æˆ·è®¾ç½®</h3>
                    <nav class="sidebar-nav">
                        <a href="#profile" class="sidebar-item active" data-section="profile">
                            <span>ğŸ‘¤</span>
                            <span>ä¸ªäººèµ„æ–™</span>
                        </a>
                        <a href="#security" class="sidebar-item" data-section="security">
                            <span>ğŸ”’</span>
                            <span>å®‰å…¨è®¾ç½®</span>
                        </a>
                        <a href="#notion" class="sidebar-item" data-section="notion">
                            <span>ğŸ”—</span>
                            <span>Notioné…ç½®</span>
                        </a>
                    </nav>
                </div>
            </aside>

            <!-- ä¸»å†…å®¹åŒº -->
            <div class="settings-content">
                <!-- ä¸ªäººèµ„æ–™å¡ç‰‡ -->
                <section class="settings-section" id="profile-section">
                    <h2>ä¸ªäººèµ„æ–™</h2>

                    <div class="profile-card">
                        <div class="profile-avatar-section">
                            <div class="profile-avatar-large">ğŸ‘¤</div>
                            <div>
                                <h3 id="profile-username" style="margin: 0 0 4px 0; font-size: 1.25rem;">åŠ è½½ä¸­...</h3>
                                <p id="profile-email" style="margin: 0; color: #6b7280;">åŠ è½½ä¸­...</p>
                            </div>
                        </div>

                        <form class="profile-form" id="profile-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>ç”¨æˆ·å</label>
                                    <input type="text" id="profile-username-input" class="form-input" readonly>
                                    <div class="form-hint">ç”¨æˆ·åä¸èƒ½ä¿®æ”¹</div>
                                </div>

                                <div class="form-group">
                                    <label>ç”µå­é‚®ç®±</label>
                                    <input type="email" id="profile-email-input" class="form-input" required>
                                </div>
                            </div>

                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary" id="cancel-profile-btn">å–æ¶ˆ</button>
                                <button type="submit" class="btn btn-primary">ä¿å­˜æ›´æ”¹</button>
                            </div>
                        </form>

                        <!-- è´¦æˆ·ç»Ÿè®¡ -->
                        <div class="stats-card">
                            <h3>è´¦æˆ·ç»Ÿè®¡</h3>
                            <div class="stats-grid">
                                <div class="stat-item">
                                    <div class="stat-value" id="stat-uploads">0</div>
                                    <div class="stat-label">æ€»ä¸Šä¼ æ¬¡æ•°</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" id="stat-records">0</div>
                                    <div class="stat-label">å¯¼å…¥è®°å½•æ•°</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" id="stat-days">0å¤©</div>
                                    <div class="stat-label">æ³¨å†Œæ—¶é•¿</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- å®‰å…¨è®¾ç½®å¡ç‰‡ -->
                <section class="settings-section" id="security-section" style="display: none;">
                    <h2>å®‰å…¨è®¾ç½®</h2>

                    <div class="security-card">
                        <form id="password-form">
                            <h3>ä¿®æ”¹å¯†ç </h3>

                            <div class="form-group">
                                <label>å½“å‰å¯†ç </label>
                                <input type="password" id="current-password" class="form-input" required>
                            </div>

                            <div class="form-group">
                                <label>æ–°å¯†ç </label>
                                <div class="input-with-icon">
                                    <input type="password" id="new-password" class="form-input" required minlength="8">
                                    <button type="button" class="input-icon" id="toggle-new-password">ğŸ‘ï¸</button>
                                </div>

                                <!-- å¯†ç å¼ºåº¦æŒ‡ç¤ºå™¨ -->
                                <div class="password-strength">
                                    <div class="strength-bar">
                                        <div class="strength-fill" id="password-strength-fill"></div>
                                    </div>
                                    <div class="strength-text" id="password-strength-text">å¯†ç å¼ºåº¦ï¼šæœªè¾“å…¥</div>
                                </div>

                                <div class="form-hint">è‡³å°‘8ä¸ªå­—ç¬¦ï¼ŒåŒ…å«å¤§å°å†™å­—æ¯å’Œæ•°å­—</div>
                            </div>

                            <div class="form-group">
                                <label>ç¡®è®¤æ–°å¯†ç </label>
                                <input type="password" id="confirm-new-password" class="form-input" required>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">æ›´æ–°å¯†ç </button>
                            </div>
                        </form>
                    </div>

                    <!-- ä¼šè¯ç®¡ç† -->
                    <div class="sessions-card">
                        <h3>æ´»è·ƒä¼šè¯</h3>
                        <div class="sessions-list" id="sessions-list">
                            <!-- åŠ¨æ€åŠ è½½ -->
                            <div class="session-item">
                                <div class="session-info">
                                    <span class="session-device">å½“å‰æµè§ˆå™¨</span>
                                    <span class="session-time">åˆšåˆš</span>
                                </div>
                                <span class="badge badge-success">å½“å‰</span>
                            </div>
                        </div>
                        <button class="btn btn-danger" id="revoke-all-sessions-btn" style="margin-top: 16px;">
                            æ’¤é”€æ‰€æœ‰å…¶ä»–ä¼šè¯
                        </button>
                    </div>
                </section>

                <!-- Notioné…ç½®å¡ç‰‡ -->
                <section class="settings-section" id="notion-section" style="display: none;">
                    <h2>Notioné…ç½®</h2>

                    <div class="notion-config-card">
                        <div class="config-header">
                            <h3>è¿æ¥æ‚¨çš„Notionæ•°æ®åº“</h3>
                            <p>é…ç½®æ‚¨çš„Notion APIå¯†é’¥å’Œæ•°æ®åº“IDä»¥å¼€å§‹å¯¼å…¥è´¦å•</p>
                        </div>

                        <!-- é…ç½®çŠ¶æ€ -->
                        <div class="config-status" id="config-status">
                            <div class="config-status-icon" id="config-status-icon">â“</div>
                            <div class="config-status-text">
                                <h4 id="config-status-title">æœªé…ç½®</h4>
                                <p id="config-status-desc">æ‚¨è¿˜æ²¡æœ‰é…ç½®Notioné›†æˆ</p>
                            </div>
                        </div>

                        <form id="notion-config-form">
                            <div class="form-group">
                                <label>é…ç½®åç§°</label>
                                <input type="text" id="config-name" class="form-input" value="é»˜è®¤é…ç½®">
                                <div class="form-hint">ä¸ºæ‚¨çš„é…ç½®èµ·ä¸€ä¸ªä¾¿äºè¯†åˆ«çš„åç§°</div>
                            </div>

                            <div class="form-group">
                                <label>Notion APIå¯†é’¥</label>
                                <div class="input-with-icon">
                                    <input type="password" id="notion-api-key" class="form-input" placeholder="secret_..." required>
                                    <button type="button" class="input-icon" id="toggle-api-key">ğŸ‘ï¸</button>
                                </div>
                                <div class="form-hint">
                                    åœ¨<a href="https://www.notion.so/my-integrations" target="_blank" class="link">Notioné›†æˆé¡µé¢</a>åˆ›å»ºé›†æˆä»¥è·å–APIå¯†é’¥
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>æ”¶å…¥æ•°æ®åº“ID</label>
                                    <input type="text" id="income-db-id" class="form-input" placeholder="abc123..." required>
                                    <div class="form-hint">ä»æ”¶å…¥æ•°æ®åº“URLä¸­å¤åˆ¶</div>
                                </div>

                                <div class="form-group">
                                    <label>æ”¯å‡ºæ•°æ®åº“ID</label>
                                    <input type="text" id="expense-db-id" class="form-input" placeholder="def456..." required>
                                    <div class="form-hint">ä»æ”¯å‡ºæ•°æ®åº“URLä¸­å¤åˆ¶</div>
                                </div>
                            </div>

                            <div class="form-actions">
                                <button type="button" class="btn btn-outline" id="verify-config-btn">
                                    âœ“ éªŒè¯é…ç½®
                                </button>
                                <button type="submit" class="btn btn-primary">ä¿å­˜é…ç½®</button>
                            </div>
                        </form>

                        <!-- éªŒè¯ç»“æœ -->
                        <div class="verification-result" id="verification-result" style="display: none;">
                            <!-- åŠ¨æ€æ˜¾ç¤ºéªŒè¯ç»“æœ -->
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <!-- æ¶ˆæ¯æç¤ºå®¹å™¨ -->
    <div id="toast-container" style="position: fixed; top: 80px; right: 24px; z-index: 2000;"></div>

    <!-- æ€§èƒ½ä¼˜åŒ–å·¥å…·åº“ -->
    <script src="/static/js/perf-utils.js"></script>
    <script src="/static/js/auth.js"></script>
    <script src="/static/js/navbar.js"></script>
    <script src="/static/js/settings.js"></script>

    <style>
    .form-group {
        margin-bottom: 20px;
    }

    .form-group label {
        display: block;
        font-weight: 600;
        margin-bottom: 8px;
        color: #374151;
        font-size: 0.95rem;
    }

    .form-input {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid #e5e7eb;
        border-radius: 10px;
        font-size: 1rem;
        font-family: inherit;
        transition: all 0.2s ease;
        background: #f9fafb;
    }

    .form-input:focus {
        outline: none;
        border-color: #667eea;
        background: white;
        box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
    }

    .form-input[readonly] {
        background: #f3f4f6;
        cursor: not-allowed;
    }

    .input-with-icon {
        position: relative;
    }

    .input-with-icon .form-input {
        padding-right: 48px;
    }

    .input-icon {
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        cursor: pointer;
        font-size: 1.2rem;
    }

    .form-hint {
        margin-top: 6px;
        font-size: 0.875rem;
        color: #9ca3af;
    }

    .password-strength {
        margin-top: 12px;
    }

    .strength-bar {
        height: 4px;
        background: #e5e7eb;
        border-radius: 2px;
        overflow: hidden;
    }

    .strength-fill {
        height: 100%;
        width: 0%;
        transition: all 0.3s ease;
    }

    .strength-fill.weak {
        width: 33%;
        background: #ef4444;
    }

    .strength-fill.medium {
        width: 66%;
        background: #f59e0b;
    }

    .strength-fill.strong {
        width: 100%;
        background: #10b981;
    }

    .strength-text {
        margin-top: 8px;
        font-size: 0.875rem;
        color: #6b7280;
    }

    .badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 0.875rem;
        font-weight: 600;
    }

    .badge-success {
        background: rgba(16, 185, 129, 0.1);
        color: #059669;
    }

    /* Toast æ ·å¼ */
    .toast {
        padding: 14px 20px;
        border-radius: 12px;
        background: white;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        margin-bottom: 12px;
        animation: slideIn 0.3s ease;
    }

    .toast.success {
        border-left: 4px solid #10b981;
    }

    .toast.error {
        border-left: 4px solid #ef4444;
    }

    @keyframes slideIn {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }
    </style>
</body>
</html>
