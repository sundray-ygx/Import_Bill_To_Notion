<!-- 导航栏组件 -->
<nav class="navbar" id="navbar" role="navigation" aria-label="主导航">
    <div class="navbar-container">
        <!-- Logo -->
        <div class="navbar-brand">
            <a href="/" class="brand-link" aria-label="首页">
                <svg class="brand-icon" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 3v18h18"/>
                    <path d="M18.7 8l-5.1 5.2-2.8-2.7L7 14.3"/>
                </svg>
                <span class="brand-text">财务管理平台</span>
            </a>
        </div>

        <!-- 主导航（已登录用户） -->
        <div class="navbar-nav" id="main-nav" style="display: none;">
            <a href="/bill-management" class="nav-item {% if request.url.path == '/bill-management' %}active{% endif %}">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                    <polyline points="14 2 14 8 20 8"/>
                    <line x1="16" y1="13" x2="8" y2="13"/>
                    <line x1="16" y1="17" x2="8" y2="17"/>
                    <polyline points="10 9 9 9 8 9"/>
                </svg>
                <span>账单管理</span>
            </a>
            <a href="/review" class="nav-item {% if request.url.path == '/review' %}active{% endif %}">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="12" y1="20" x2="12" y2="10"/>
                    <line x1="18" y1="20" x2="18" y2="4"/>
                    <line x1="6" y1="20" x2="6" y2="16"/>
                </svg>
                <span>财务复盘</span>
            </a>
            <a href="/history" class="nav-item {% if request.url.path == '/history' %}active{% endif %}">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"/>
                    <polyline points="12 6 12 12 16 14"/>
                </svg>
                <span>导入记录</span>
            </a>
        </div>

        <!-- 未登录导航 -->
        <div class="navbar-nav" id="guest-nav">
            <a href="/features" class="nav-item">功能介绍</a>
            <a href="/docs" class="nav-item">帮助文档</a>
        </div>

        <!-- 用户菜单 -->
        <div class="navbar-user" id="user-menu-container" style="display: none;">
            <button class="user-menu-toggle" id="user-menu-toggle" aria-expanded="false" aria-haspopup="true">
                <div class="user-avatar" id="navbar-avatar">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                        <circle cx="12" cy="7" r="4"/>
                    </svg>
                </div>
                <span class="user-name" id="navbar-username">用户</span>
                <svg class="dropdown-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="6 9 12 15 18 9"/>
                </svg>
            </button>

            <!-- 下拉菜单 -->
            <div class="user-dropdown" id="user-dropdown" style="display: none;" role="menu" aria-label="用户菜单">
                <div class="dropdown-header">
                    <div class="user-avatar-large" id="dropdown-avatar">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                            <circle cx="12" cy="7" r="4"/>
                        </svg>
                    </div>
                    <div class="user-info">
                        <div class="user-name-large" id="dropdown-username">用户名</div>
                        <div class="user-email" id="dropdown-email">user@example.com</div>
                    </div>
                </div>

                <div class="dropdown-divider"></div>

                <a href="/settings" class="dropdown-item" role="menuitem">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
                        <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
                    </svg>
                    <span>Notion配置</span>
                </a>

                <!-- 系统管理（超级管理员专属） -->
                <div class="dropdown-section admin-only" id="admin-menu" style="display: none;">
                    <div class="dropdown-section-title">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="3"/>
                            <path d="M12 1v6m0 6v6"/>
                            <path d="m5.6 5.6 4.2 4.2m4.4 4.4 4.2 4.2"/>
                            <path d="M1 12h6m6 0h6"/>
                            <path d="m5.6 18.4 4.2-4.2m4.4-4.4 4.2-4.2"/>
                        </svg>
                        <span>系统管理</span>
                    </div>
                    <a href="/admin/users" class="dropdown-item" role="menuitem">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                            <circle cx="9" cy="7" r="4"/>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                        </svg>
                        <span>用户管理</span>
                    </a>
                    <a href="/log-management" class="dropdown-item" role="menuitem">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                            <polyline points="10 9 9 9 8 9"/>
                        </svg>
                        <span>日志管理</span>
                    </a>
                    <a href="/service-management" class="dropdown-item" role="menuitem">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
                        </svg>
                        <span>服务管理</span>
                    </a>
                    <div class="dropdown-divider"></div>
                </div>

                <button class="dropdown-item dropdown-item-danger" id="logout-btn" role="menuitem">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                        <polyline points="16 17 21 12 16 7"/>
                        <line x1="21" y1="12" x2="9" y2="12"/>
                    </svg>
                    <span>退出登录</span>
                </button>
            </div>
        </div>

        <!-- 未登录按钮组 -->
        <div class="navbar-auth" id="auth-buttons">
            <a href="/login" class="btn btn-outline btn-sm">登录</a>
            <a href="/register" class="btn btn-primary btn-sm">注册</a>
        </div>

        <!-- 移动端菜单切换 -->
        <button class="navbar-toggle" id="navbar-toggle" style="display: none;" aria-label="切换菜单" aria-expanded="false">
            <span></span>
            <span></span>
            <span></span>
        </button>
    </div>
</nav>

<style>
/* ==================== 导航栏样式 ==================== */
/* 使用设计系统变量 */
@import url('/static/css/variables.css');

.navbar {
    background: var(--glass-bg-light);
    backdrop-filter: var(--glass-blur);
    -webkit-backdrop-filter: var(--glass-blur);
    border-bottom: 1px solid var(--border-light);
    position: sticky;
    top: 0;
    z-index: var(--z-sticky);
    box-shadow: var(--shadow-sm);
    height: var(--navbar-height);
    transition: var(--transition-base);
}

.navbar.scrolled {
    box-shadow: var(--shadow-md);
}

.navbar-container {
    max-width: var(--container-xl);
    margin: 0 auto;
    padding: 0 var(--spacing-5);
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--spacing-4);
}

/* Logo */
.navbar-brand {
    display: flex;
    align-items: center;
}

.brand-link {
    display: flex;
    align-items: center;
    gap: var(--spacing-2_5);
    text-decoration: none;
    color: var(--text-primary);
    font-weight: var(--font-bold);
    font-size: var(--font-lg);
    font-family: var(--font-display);
    transition: var(--transition-fast);
}

.brand-link:hover {
    opacity: 0.9;
}

.brand-link:focus-visible {
    outline: 2px solid var(--color-primary-500);
    outline-offset: 4px;
    border-radius: var(--radius-md);
}

.brand-icon {
    color: var(--color-primary-600);
    flex-shrink: 0;
}

.brand-text {
    white-space: nowrap;
}

/* 导航项 */
.navbar-nav {
    display: flex;
    gap: var(--spacing-1);
    align-items: center;
    flex: 1;
}

.nav-item {
    display: flex;
    align-items: center;
    gap: var(--spacing-1_5);
    padding: var(--spacing-2) var(--spacing-3);
    border-radius: var(--radius-lg);
    text-decoration: none;
    color: var(--text-secondary);
    font-weight: var(--font-medium);
    font-size: var(--font-sm);
    transition: var(--transition-base);
    white-space: nowrap;
    cursor: pointer;
    position: relative;
}

.nav-item svg {
    color: currentColor;
    flex-shrink: 0;
}

.nav-item:hover {
    background: var(--color-primary-50);
    color: var(--color-primary-600);
}

.nav-item:focus-visible {
    outline: 2px solid var(--color-primary-500);
    outline-offset: 2px;
}

.nav-item.active {
    background: var(--color-primary-100);
    color: var(--color-primary-700);
    font-weight: var(--font-semibold);
}

.nav-item.active::after {
    content: '';
    position: absolute;
    bottom: -1px;
    left: 50%;
    transform: translateX(-50%);
    width: 20px;
    height: 2px;
    background: var(--gradient-primary);
    border-radius: var(--radius-full);
}

/* 用户菜单 */
.navbar-user {
    position: relative;
}

.user-menu-toggle {
    display: flex;
    align-items: center;
    gap: var(--spacing-2);
    padding: var(--spacing-1_5) var(--spacing-2_5);
    border: 1px solid transparent;
    background: transparent;
    cursor: pointer;
    border-radius: var(--radius-lg);
    transition: var(--transition-base);
    color: var(--text-primary);
}

.user-menu-toggle:hover {
    background: var(--bg-secondary);
}

.user-menu-toggle:focus-visible {
    outline: 2px solid var(--color-primary-500);
    outline-offset: 2px;
}

.user-avatar {
    width: 32px;
    height: 32px;
    min-width: 32px;
    border-radius: var(--radius-full);
    background: var(--gradient-primary);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
}

.user-name {
    font-weight: var(--font-semibold);
    color: var(--text-primary);
    font-size: var(--font-sm);
}

@media (max-width: 1024px) {
    .user-name {
        display: none;
    }
}

.dropdown-arrow {
    color: var(--text-muted);
    transition: transform var(--duration-200) var(--ease-out);
}

.user-menu-toggle[aria-expanded="true"] .dropdown-arrow {
    transform: rotate(180deg);
}

/* 下拉菜单 */
.user-dropdown {
    position: absolute;
    top: calc(100% + var(--spacing-3));
    right: 0;
    min-width: 280px;
    background: var(--bg-primary);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-xl);
    border: 1px solid var(--border-light);
    padding: var(--spacing-2);
    animation: dropdownSlideIn var(--duration-200) var(--ease-out);
    z-index: var(--z-dropdown);
}

@keyframes dropdownSlideIn {
    from {
        opacity: 0;
        transform: translateY(-8px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.dropdown-header {
    display: flex;
    align-items: center;
    gap: var(--spacing-3);
    padding: var(--spacing-3);
}

.user-avatar-large {
    width: 44px;
    height: 44px;
    min-width: 44px;
    border-radius: var(--radius-full);
    background: var(--gradient-primary);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
}

.user-info {
    flex: 1;
    min-width: 0;
}

.user-name-large {
    font-weight: var(--font-semibold);
    color: var(--text-primary);
    font-size: var(--font-base);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.user-email {
    color: var(--text-secondary);
    font-size: var(--font-sm);
    margin-top: var(--spacing-0_5);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.dropdown-item {
    display: flex;
    align-items: center;
    gap: var(--spacing-2_5);
    width: 100%;
    padding: var(--spacing-2_5) var(--spacing-3);
    border: none;
    background: transparent;
    border-radius: var(--radius-md);
    text-decoration: none;
    color: var(--text-secondary);
    font-size: var(--font-sm);
    font-weight: var(--font-normal);
    cursor: pointer;
    transition: var(--transition-fast);
    text-align: left;
}

.dropdown-item svg {
    color: var(--text-muted);
    flex-shrink: 0;
}

.dropdown-item:hover {
    background: var(--bg-secondary);
    color: var(--text-primary);
}

.dropdown-item:hover svg {
    color: var(--color-primary-600);
}

.dropdown-item:focus-visible {
    outline: 2px solid var(--color-primary-500);
    outline-offset: 2px;
}

.dropdown-item-danger {
    color: var(--color-error-600);
}

.dropdown-item-danger svg {
    color: var(--color-error-500);
}

.dropdown-item-danger:hover {
    background: var(--color-error-50);
    color: var(--color-error-700);
}

.dropdown-item-danger:hover svg {
    color: var(--color-error-600);
}

/* 下拉菜单分组 */
.dropdown-section {
    padding: var(--spacing-1) 0;
}

.dropdown-section-title {
    display: flex;
    align-items: center;
    gap: var(--spacing-2);
    padding: var(--spacing-2) var(--spacing-3);
    font-size: var(--font-xs);
    font-weight: var(--font-semibold);
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: var(--tracking-wide);
}

.dropdown-section-title svg {
    color: var(--text-muted);
}

.dropdown-section .dropdown-item {
    padding-left: var(--spacing-8);
}

.dropdown-divider {
    height: 1px;
    background: var(--border-light);
    margin: var(--spacing-2) var(--spacing-3);
}

/* 未登录按钮 */
.navbar-auth {
    display: flex;
    gap: var(--spacing-3);
    align-items: center;
}

.btn-sm {
    padding: var(--spacing-2) var(--spacing-4);
    font-size: var(--font-sm);
    height: 36px;
}

/* 按钮基础样式 */
.btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: var(--spacing-2);
    padding: var(--btn-padding-y) var(--btn-padding-x);
    border-radius: var(--btn-border-radius);
    font-size: var(--btn-font-size);
    font-weight: var(--btn-font-weight);
    text-decoration: none;
    cursor: pointer;
    transition: var(--transition-base);
    border: 1px solid transparent;
    white-space: nowrap;
}

.btn:focus-visible {
    outline: 2px solid var(--color-primary-500);
    outline-offset: 2px;
}

.btn-primary {
    background: var(--gradient-primary);
    color: white;
    box-shadow: var(--shadow-primary);
}

.btn-primary:hover {
    background: var(--gradient-primary-hover);
    box-shadow: var(--shadow-lg);
    transform: translateY(-1px);
}

.btn-primary:active {
    transform: translateY(0);
}

.btn-outline {
    background: transparent;
    border-color: var(--border-medium);
    color: var(--text-primary);
}

.btn-outline:hover {
    border-color: var(--color-primary-500);
    color: var(--color-primary-600);
    background: var(--color-primary-50);
}

/* 移动端菜单切换 */
.navbar-toggle {
    display: none;
    flex-direction: column;
    gap: var(--spacing-1);
    background: none;
    border: none;
    cursor: pointer;
    padding: var(--spacing-2);
    color: var(--text-primary);
}

.navbar-toggle:hover {
    background: var(--bg-secondary);
    border-radius: var(--radius-md);
}

.navbar-toggle:focus-visible {
    outline: 2px solid var(--color-primary-500);
    outline-offset: 2px;
    border-radius: var(--radius-md);
}

.navbar-toggle span {
    width: 20px;
    height: 2px;
    background: currentColor;
    border-radius: var(--radius-full);
    transition: var(--transition-slow);
    transform-origin: center;
}

.navbar.mobile-open .navbar-toggle span:nth-child(1) {
    transform: rotate(45deg) translate(4px, 4px);
}

.navbar.mobile-open .navbar-toggle span:nth-child(2) {
    opacity: 0;
    transform: scaleX(0);
}

.navbar.mobile-open .navbar-toggle span:nth-child(3) {
    transform: rotate(-45deg) translate(4px, -4px);
}

/* 响应式 */
@media (max-width: 1024px) {
    .navbar-container {
        padding: 0 var(--spacing-4);
    }

    .navbar-toggle {
        display: flex;
    }

    .navbar-nav {
        position: absolute;
        top: var(--navbar-height);
        left: 0;
        right: 0;
        background: var(--bg-primary);
        flex-direction: column;
        padding: var(--spacing-4);
        box-shadow: var(--shadow-lg);
        border-top: 1px solid var(--border-light);
        opacity: 0;
        visibility: hidden;
        transform: translateY(-8px);
    }

    .navbar.mobile-open .navbar-nav {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
    }

    .navbar-nav#main-nav {
        display: flex;
    }

    .nav-item {
        width: 100%;
        padding: var(--spacing-3);
        justify-content: flex-start;
    }

    .nav-item.active::after {
        display: none;
    }

    .user-dropdown {
        position: fixed;
        top: auto;
        bottom: 0;
        left: 0;
        right: 0;
        border-radius: var(--radius-2xl) var(--radius-2xl) 0 0;
        transform: translateY(100%);
        animation: slideUp var(--duration-300) var(--ease-out);
    }

    .user-dropdown.show {
        transform: translateY(0);
    }

    @keyframes slideUp {
        from {
            transform: translateY(100%);
        }
        to {
            transform: translateY(0);
        }
    }
}

@media (max-width: 640px) {
    .brand-text {
        font-size: var(--font-base);
    }

    .navbar-auth {
        gap: var(--spacing-2);
    }

    .btn-sm {
        padding: var(--spacing-2) var(--spacing-3);
        font-size: var(--font-xs);
    }
}

/* 深色模式支持 */
@media (prefers-color-scheme: dark) {
    .navbar {
        background: var(--glass-bg-dark);
        border-bottom-color: var(--border-medium);
    }

    .navbar.mobile-open .navbar-nav {
        background: var(--bg-primary);
    }
}

/* 无障碍 - 减少动画 */
@media (prefers-reduced-motion: reduce) {
    .navbar,
    .nav-item,
    .user-menu-toggle,
    .dropdown-item,
    .navbar-toggle span {
        transition: none;
    }

    .user-dropdown,
    @keyframes dropdownSlideIn,
    @keyframes slideUp {
        animation: none;
    }
}
</style>
